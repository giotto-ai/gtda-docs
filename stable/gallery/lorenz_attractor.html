

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Case study: Lorenz attractor &mdash; giotto-tda 0.1.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_SVG"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> giotto-tda
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Case study: Lorenz attractor</a><ul>
<li><a class="reference internal" href="#license-agplv3">License: AGPLv3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plotting-functions">Plotting functions</a></li>
<li><a class="reference internal" href="#setting-up-the-lorenz-attractor-simulation">Setting up the Lorenz attractor simulation</a></li>
<li><a class="reference internal" href="#resampling-the-time-series">Resampling the time series</a></li>
<li><a class="reference internal" href="#takens-embedding">Takens Embedding</a></li>
<li><a class="reference internal" href="#persistence-diagram">Persistence diagram</a></li>
<li><a class="reference internal" href="#scikit-learn-pipeline">Scikit-learn <em>Pipeline</em></a></li>
<li><a class="reference internal" href="#rescaling-the-diagram">Rescaling the diagram</a></li>
<li><a class="reference internal" href="#filtering-diagrams">Filtering diagrams</a></li>
<li><a class="reference internal" href="#persistence-entropy">Persistence entropy</a></li>
<li><a class="reference internal" href="#betti-curves">Betti Curves</a></li>
<li><a class="reference internal" href="#distances-among-diagrams">Distances among diagrams</a></li>
<li><a class="reference internal" href="#new-distance-in-the-embedding-space-permutations-and-graphs">New distance in the embedding space: permutations and graphs</a></li>
<li><a class="reference internal" href="#geodesic-distance-on-graphs">Geodesic distance on graphs</a></li>
<li><a class="reference internal" href="#synthetic-features-extracted-from-topology">Synthetic features extracted from topology</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">giotto-tda</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Case study: Lorenz attractor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gallery/lorenz_attractor.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-gallery-lorenz-attractor-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="case-study-lorenz-attractor">
<span id="sphx-glr-gallery-lorenz-attractor-py"></span><h1>Case study: Lorenz attractor<a class="headerlink" href="#case-study-lorenz-attractor" title="Permalink to this headline">¶</a></h1>
<div class="section" id="license-agplv3">
<h2>License: AGPLv3<a class="headerlink" href="#license-agplv3" title="Permalink to this headline">¶</a></h2>
<p>This notebook contains a full TDA pipeline to analyse the transitions of
the Lorenz system to a chaotic regime from the stable one and viceversa.</p>
<p>The first step consists in importing relevant <em>gtda</em> components and
other useful libraries or modules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the gtda module</span>
<span class="kn">from</span> <span class="nn">gtda.time_series</span> <span class="kn">import</span> <span class="n">Resampler</span><span class="p">,</span> <span class="n">TakensEmbedding</span><span class="p">,</span> <span class="n">SlidingWindow</span><span class="p">,</span> <span class="n">PermutationEntropy</span>
<span class="kn">from</span> <span class="nn">gtda.homology</span> <span class="kn">import</span> <span class="n">VietorisRipsPersistence</span>
<span class="kn">from</span> <span class="nn">gtda.diagrams</span> <span class="kn">import</span> <span class="n">Scaler</span><span class="p">,</span> <span class="n">Filtering</span><span class="p">,</span> <span class="n">PersistenceEntropy</span><span class="p">,</span> <span class="n">BettiCurve</span><span class="p">,</span> <span class="n">PairwiseDistance</span>
<span class="kn">from</span> <span class="nn">gtda.graphs</span> <span class="kn">import</span> <span class="n">KNeighborsGraph</span><span class="p">,</span> <span class="n">GraphGeodesicDistance</span>

<span class="kn">from</span> <span class="nn">gtda.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">gobj</span>
<span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span><span class="p">,</span> <span class="n">iplot</span>
<span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Import data from openml</span>
<span class="kn">import</span> <span class="nn">openml</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plotting-functions">
<h1>Plotting functions<a class="headerlink" href="#plotting-functions" title="Permalink to this headline">¶</a></h1>
<p>The <em>plotting.py</em> file is required to use the following plotting
functions. It can be found in the <em>examples</em> folder on out github.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting functions</span>
<span class="kn">from</span> <span class="nn">plotting</span> <span class="kn">import</span> <span class="n">plot_diagram</span><span class="p">,</span> <span class="n">plot_landscapes</span>
<span class="kn">from</span> <span class="nn">plotting</span> <span class="kn">import</span> <span class="n">plot_betti_surfaces</span><span class="p">,</span> <span class="n">plot_betti_curves</span>
<span class="kn">from</span> <span class="nn">plotting</span> <span class="kn">import</span> <span class="n">plot_point_cloud</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-lorenz-attractor-simulation">
<h1>Setting up the Lorenz attractor simulation<a class="headerlink" href="#setting-up-the-lorenz-attractor-simulation" title="Permalink to this headline">¶</a></h1>
<p>In the next block we set up all the parameters of the Lorenz system and
we define also the instants at which the regime (stable VS chaotic)
changes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the trajectories of the Lorenz system</span>
<span class="kn">from</span> <span class="nn">openml.datasets.functions</span> <span class="kn">import</span> <span class="n">get_dataset</span>

<span class="n">point_cloud</span> <span class="o">=</span> <span class="n">get_dataset</span><span class="p">(</span><span class="mi">42182</span><span class="p">)</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">dataset_format</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plot_point_cloud</span><span class="p">(</span><span class="n">point_cloud</span><span class="p">)</span>

<span class="c1"># Selecting the z-axis and the label rho</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">point_cloud</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">point_cloud</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>

<span class="c1"># Plotting the Lorenz system</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory of the Lorenz solution, projected along the z-axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="resampling-the-time-series">
<h1>Resampling the time series<a class="headerlink" href="#resampling-the-time-series" title="Permalink to this headline">¶</a></h1>
<p>It is important to find the correct time scale at which key signals take
place. Here we propose one possible resampling period: <em>10h</em>. Recall
that the unit time is <em>1h</em>. The resampler method is used to perform the
resampling.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">period</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">periodicSampler</span> <span class="o">=</span> <span class="n">Resampler</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>

<span class="n">periodicSampler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_sampled</span><span class="p">,</span> <span class="n">y_sampled</span> <span class="o">=</span> <span class="n">periodicSampler</span><span class="o">.</span><span class="n">transform_resample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_sampled</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory of the Lorenz solution, projected along the z-axis and resampled every 10h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Steps of the Pipeline</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;sampling&#39;</span><span class="p">,</span> <span class="n">Resampler</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;regressor&#39;</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="p">]</span>

<span class="c1"># Sklearn Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>

<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="takens-embedding">
<h1>Takens Embedding<a class="headerlink" href="#takens-embedding" title="Permalink to this headline">¶</a></h1>
<p>In order to obtain meaningful topological features from a time series,
we use a delayed-time embedding technique, invented by F. Takens in the
late sixties. The idea is simple: given a time series X(t), one can
extract a sequence of vectors of the form X_i := [(X(t_i)), X(t_i + 2
tau), …, X(t_i + M tau)]. The difference between t_i and t_i-1 is called
<em>stride</em>; the numbers M and tau are optimized authomatically in this
example (they can be set by the user if needed).</p>
<p>The <em>outer window</em> allows us to apply Takens embedding locally on a
certain interval rather than over the whole time series. The result of
this procedure is therefore a time series of point clouds with possibly
interesting topologies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">embedding_dimension</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">embedding_time_delay</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">embedder</span> <span class="o">=</span> <span class="n">TakensEmbedding</span><span class="p">(</span><span class="n">parameters_type</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="n">embedding_dimension</span><span class="p">,</span>
                           <span class="n">time_delay</span><span class="o">=</span><span class="n">embedding_time_delay</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">embedder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">embedder_time_delay</span> <span class="o">=</span> <span class="n">embedder</span><span class="o">.</span><span class="n">time_delay_</span>
<span class="n">embedder_dimension</span> <span class="o">=</span> <span class="n">embedder</span><span class="o">.</span><span class="n">dimension_</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal embedding time delay based on mutual information: &#39;</span><span class="p">,</span> <span class="n">embedder_time_delay</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Optimal embedding dimension based on false nearest neighbors: &#39;</span><span class="p">,</span> <span class="n">embedder_dimension</span><span class="p">)</span>

<span class="n">X_embedded</span><span class="p">,</span> <span class="n">y_embedded</span> <span class="o">=</span> <span class="n">embedder</span><span class="o">.</span><span class="n">transform_resample</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">,</span> <span class="n">y_sampled</span><span class="p">)</span>

<span class="n">window_width</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">window_stride</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">sliding_window</span> <span class="o">=</span> <span class="n">SlidingWindow</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">window_width</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">window_stride</span><span class="p">)</span>
<span class="n">sliding_window</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_embedded</span><span class="p">,</span> <span class="n">y_embedded</span><span class="p">)</span>

<span class="n">X_windows</span><span class="p">,</span> <span class="n">y_windows</span> <span class="o">=</span> <span class="n">sliding_window</span><span class="o">.</span><span class="n">transform_resample</span><span class="p">(</span><span class="n">X_embedded</span><span class="p">,</span> <span class="n">y_embedded</span><span class="p">)</span>

<span class="c1"># Plotting Takens embedding of the third outer window</span>
<span class="n">window_number</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">X_windows</span><span class="p">[</span><span class="n">window_number</span><span class="p">][:,:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">plot_point_cloud</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

<span class="c1"># Plotting the time series associated to the above point cloud.</span>
<span class="c1"># Notice the two periodicities corresponding to the loops in the embedding</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">[(</span><span class="n">window_number</span><span class="o">*</span><span class="n">window_stride</span><span class="p">)</span><span class="o">*</span><span class="n">embedder_time_delay</span><span class="o">*</span><span class="n">embedder_dimension</span><span class="p">:</span>
                   <span class="p">(</span><span class="n">window_number</span><span class="o">*</span><span class="n">window_stride</span> <span class="o">+</span> <span class="n">window_width</span><span class="p">)</span><span class="o">*</span><span class="n">embedder_time_delay</span><span class="o">*</span><span class="n">embedder_dimension</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The Lorenz solution over one outer window &#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="persistence-diagram">
<h1>Persistence diagram<a class="headerlink" href="#persistence-diagram" title="Permalink to this headline">¶</a></h1>
<p>The topological information of the correlation metric is synthesised in
the persistent diagram. The horizonral axis corresponds to the moment in
which an homological generator is born, while the vertical axis
corresponds to the moments in which an homological generator dies. The
generators of the homology groups (at given rank) are colored
differently.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">homology_dimensions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">persistenceDiagram</span> <span class="o">=</span> <span class="n">VietorisRipsPersistence</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">max_edge_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                             <span class="n">homology_dimensions</span><span class="o">=</span><span class="n">homology_dimensions</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">persistenceDiagram</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_windows</span><span class="p">)</span>
<span class="n">X_diagrams</span> <span class="o">=</span> <span class="n">persistenceDiagram</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_windows</span><span class="p">,</span> <span class="n">y_windows</span><span class="p">)</span>

<span class="c1"># Plot the persistence diagram</span>
<span class="n">plot_diagram</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">[</span><span class="n">window_number</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="scikit-learn-pipeline">
<h1>Scikit-learn <em>Pipeline</em><a class="headerlink" href="#scikit-learn-pipeline" title="Permalink to this headline">¶</a></h1>
<p>One of the advantages of giotto-tda is the compatibility with
scikit-learn. It is possible to set up a full pipeline such as the one
above in a few lines. We will show how in the next section.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Steps of the Pipeline</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;sampling&#39;</span><span class="p">,</span> <span class="n">Resampler</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;embedding&#39;</span><span class="p">,</span> <span class="n">TakensEmbedding</span><span class="p">(</span><span class="n">parameters_type</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="n">embedding_dimension</span><span class="p">,</span>
                                  <span class="n">time_delay</span><span class="o">=</span><span class="n">embedding_time_delay</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;window&#39;</span><span class="p">,</span> <span class="n">SlidingWindow</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">window_width</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">window_stride</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;diagrams&#39;</span><span class="p">,</span> <span class="n">VietorisRipsPersistence</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">max_edge_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                            <span class="n">homology_dimensions</span><span class="o">=</span><span class="n">homology_dimensions</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="p">]</span>

<span class="c1"># Sklearn Pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>

<span class="c1"># Running the pipeline</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_diagrams</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Plotting the final persistent diagram of one outer window</span>
<span class="n">plot_diagram</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">[</span><span class="n">window_number</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="rescaling-the-diagram">
<h1>Rescaling the diagram<a class="headerlink" href="#rescaling-the-diagram" title="Permalink to this headline">¶</a></h1>
<p>Rescaling the diagram means normalizing the points such that their
distance from the <em>empty diagram</em> is equal to one. Once the diagram is
rescaled, we can filter noise by removing all the points that are close
to the diagonal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">diagram_scaler</span> <span class="o">=</span> <span class="n">Scaler</span><span class="p">()</span>
<span class="n">diagram_scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">)</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">diagram_scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">)</span>

<span class="n">plot_diagram</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[</span><span class="n">window_number</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-diagrams">
<h1>Filtering diagrams<a class="headerlink" href="#filtering-diagrams" title="Permalink to this headline">¶</a></h1>
<p>Filtering noise from a diagram corresponds to eliminating all the
homology generators whose lifespan is too short to be significant. It
means equivalently that we are removing the points closer to the
diagonal than a centrain threshold.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preparing the filtering transformer</span>
<span class="n">diagram_filter</span> <span class="o">=</span> <span class="n">Filtering</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">homology_dimensions</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">diagram_filter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="n">X_filtered</span> <span class="o">=</span> <span class="n">diagram_filter</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="n">plot_diagram</span><span class="p">(</span><span class="n">X_filtered</span><span class="p">[</span><span class="n">window_number</span><span class="p">])</span>

<span class="c1"># Wrapping up all the steps inside a scikit-learn pipeline</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;sampling&#39;</span><span class="p">,</span> <span class="n">Resampler</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;embedding&#39;</span><span class="p">,</span> <span class="n">TakensEmbedding</span><span class="p">(</span><span class="n">parameters_type</span><span class="o">=</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="n">embedding_dimension</span><span class="p">,</span>
                                    <span class="n">time_delay</span><span class="o">=</span><span class="n">embedding_time_delay</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;window&#39;</span><span class="p">,</span> <span class="n">SlidingWindow</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">window_width</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">window_stride</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;diagrams&#39;</span><span class="p">,</span> <span class="n">VietorisRipsPersistence</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">max_edge_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                            <span class="n">homology_dimensions</span><span class="o">=</span><span class="n">homology_dimensions</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;diagrams_scaler&#39;</span><span class="p">,</span> <span class="n">Scaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;diagrams_filter&#39;</span><span class="p">,</span> <span class="n">Filtering</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">pipeline_filter</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>

<span class="n">pipeline_filter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_filtered_noisy</span> <span class="o">=</span> <span class="n">pipeline_filter</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">plot_diagram</span><span class="p">(</span><span class="n">X_filtered_noisy</span><span class="p">[</span><span class="n">window_number</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="persistence-entropy">
<h1>Persistence entropy<a class="headerlink" href="#persistence-entropy" title="Permalink to this headline">¶</a></h1>
<p>In this section we show how to compute the entropy of persistence
diagrams.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perparing the filtering transformer</span>
<span class="n">persistent_entropy</span> <span class="o">=</span> <span class="n">PersistenceEntropy</span><span class="p">()</span>
<span class="n">persistent_entropy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="n">X_persistent_entropy</span> <span class="o">=</span> <span class="n">persistent_entropy</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_persistent_entropy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Trajectory of the Lorenz solution, projected along the z-axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="betti-curves">
<h1>Betti Curves<a class="headerlink" href="#betti-curves" title="Permalink to this headline">¶</a></h1>
<p>In this section we show how to compute the Betti curves of a persistent
diagram. We also show the plot of the Betti surface, i.e. the time-stack
of the bettu curves.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">betti_curves</span> <span class="o">=</span> <span class="n">BettiCurve</span><span class="p">()</span>
<span class="n">betti_curves</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="n">X_betti_curves</span> <span class="o">=</span> <span class="n">betti_curves</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="n">plot_betti_curves</span><span class="p">(</span><span class="n">X_betti_curves</span><span class="p">[</span><span class="n">window_number</span><span class="p">])</span>

<span class="n">plot_betti_surfaces</span><span class="p">(</span><span class="n">X_betti_curves</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="distances-among-diagrams">
<h1>Distances among diagrams<a class="headerlink" href="#distances-among-diagrams" title="Permalink to this headline">¶</a></h1>
<p>In this section we show how to compute distances among persistent
diagrams. There are many notions of distances: here we use the
<em>bottleneck distance</em> as an example.</p>
<p>We stress that the <em>i-th</em> row of this matrix is the distance of the
<em>i-th</em> diagram from all the others.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># We change metric: we compute the landscape distance among the diagrams</span>
<span class="n">diagram_distance</span> <span class="o">=</span> <span class="n">PairwiseDistance</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">metric_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;n_layers&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;n_bins&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">},</span>
                                       <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">diagram_distance</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">)</span>
<span class="n">X_distance_L</span> <span class="o">=</span> <span class="n">diagram_distance</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">)</span>

<span class="c1"># Plot of the landascape L2 distance between persistent diagrams</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X_distance_L</span><span class="p">[:,:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Landscape L2 distance matrix for H0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># We change metric: we compute the wasserestein distance among the diagrams</span>
<span class="n">diagram_distance</span> <span class="o">=</span> <span class="n">PairwiseDistance</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;wasserstein&#39;</span><span class="p">,</span> <span class="n">metric_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">},</span>
                                    <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">diagram_distance</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">)</span>
<span class="n">X_distance_W</span> <span class="o">=</span> <span class="n">diagram_distance</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_diagrams</span><span class="p">)</span>

<span class="c1"># Plot of the landascape L2 distance between persistent diagrams</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X_distance_W</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2-norm of 2-wassertein distance matrices&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="new-distance-in-the-embedding-space-permutations-and-graphs">
<h1>New distance in the embedding space: permutations and graphs<a class="headerlink" href="#new-distance-in-the-embedding-space-permutations-and-graphs" title="Permalink to this headline">¶</a></h1>
<p>We propose here a new way to compute distances between points in the
embedding space. Instead of considering the Euclidean distance in the
Takens space, we propose to build a k-nearest neightbors graph and then
use the geodesic distance on such graph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kNN_graph</span> <span class="o">=</span> <span class="n">KNeighborsGraph</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">kNN_graph</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_embedded</span><span class="p">)</span>
<span class="n">X_kNN</span> <span class="o">=</span> <span class="n">kNN_graph</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_embedded</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_embedded</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="geodesic-distance-on-graphs">
<h1>Geodesic distance on graphs<a class="headerlink" href="#geodesic-distance-on-graphs" title="Permalink to this headline">¶</a></h1>
<p>Given the graph embedding, the natural notion of distance between
vertices corresponds to the lengths of the shortest path connecting two
vertices. This is also known as <em>graph geodesic distance</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geodesic_distance</span> <span class="o">=</span> <span class="n">GraphGeodesicDistance</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">geodesic_distance</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_kNN</span><span class="p">)</span>
<span class="n">X_GeoNN</span> <span class="o">=</span> <span class="n">geodesic_distance</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_kNN</span><span class="p">)</span>

<span class="c1"># Plotting the geodesic distance</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X_GeoNN</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Plot of the geodesic distance of the first outer window kNN graph&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="synthetic-features-extracted-from-topology">
<h1>Synthetic features extracted from topology<a class="headerlink" href="#synthetic-features-extracted-from-topology" title="Permalink to this headline">¶</a></h1>
<p>One can use persistent diagrams as he pleases. Here we show one way of
extracting summary information from the time-series of diagrams: the
<em>permutation entropy</em>. The entropy is computed by estimating a
probability based on teh counting how many permutation patterns appear
along the time series within the outer window.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing permutation entropy</span>
<span class="n">permutation_entropy</span> <span class="o">=</span> <span class="n">PermutationEntropy</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">permutation_entropy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_windows</span><span class="p">)</span>
<span class="n">X_entropy</span> <span class="o">=</span> <span class="n">permutation_entropy</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_windows</span><span class="p">)</span>

<span class="c1"># Plot the sampled Lorenz solution, projected along the z-axis</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_sampled</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Resampled solution of the Lorenz attractor projected along the z-axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Plot of the permutation entropy time-series</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_entropy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Permutation entropy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-gallery-lorenz-attractor-py">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../_downloads/84810330c53807e4e7f8066eb58cb2f7/lorenz_attractor.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">lorenz_attractor.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../_downloads/0bfcf10019316bc8259b7f5edb96d6df/lorenz_attractor.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">lorenz_attractor.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, L2F

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>